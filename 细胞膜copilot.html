<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>3D 细胞膜流动镶嵌模型</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    #container { width: 100vw; height: 100vh; position: relative; }
    .label {
      color: #fff;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.6);
      padding: 2px 6px;
      border-radius: 4px;
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div id="container"></div>

  <!-- 引入 Three.js 核心库 -->
  <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
  <!-- 引入 OrbitControls -->
  <script src="https://unpkg.com/three@0.150.1/examples/jsm/controls/OrbitControls.js"></script>
  <!-- 引入 CSS2DRenderer 用于 HTML 标签 -->
  <script src="https://unpkg.com/three@0.150.1/examples/jsm/renderers/CSS2DRenderer.js"></script>

  <script>
    // 全局变量
    let scene, camera, renderer, labelRenderer, controls;
    init();
    animate();

    function init() {
      const container = document.getElementById('container');

      // 场景与相机
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 5, 12);

      // 渲染器
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      container.appendChild(renderer.domElement);

      // HTML 标签渲染器
      labelRenderer = new THREE.CSS2DRenderer();
      labelRenderer.setSize(container.clientWidth, container.clientHeight);
      labelRenderer.domElement.style.position = 'absolute';
      labelRenderer.domElement.style.top = '0';
      container.appendChild(labelRenderer.domElement);

      // 光源
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);
      const directional = new THREE.DirectionalLight(0xffffff, 0.8);
      directional.position.set(5, 10, 7);
      scene.add(directional);

      // 交互控制
      controls = new THREE.OrbitControls(camera, labelRenderer.domElement);
      controls.minDistance = 5;
      controls.maxDistance = 30;

      // 构建磷脂双分子层
      const lipidGroup = new THREE.Group();
      const gridSize = 10, spacing = 0.6;
      for (let i = -gridSize/2; i < gridSize/2; i++) {
        for (let j = -gridSize/2; j < gridSize/2; j++) {
          const x = i * spacing, y = j * spacing;
          lipidGroup.add(createPhospholipid(x, y, +0.5));  // 上层
          lipidGroup.add(createPhospholipid(x, y, -0.5, true)); // 下层（翻转）
        }
      }
      scene.add(lipidGroup);

      // 嵌入跨膜蛋白
      const channel = createChannelProtein();
      channel.position.set(-2, 0, 0);
      scene.add(channel);
      addLabel(channel, '跨膜通道蛋白<br>调节物质进出', new THREE.Vector3(0, 2.5, 0));

      // 周边蛋白
      const peripheral = createPeripheralProtein();
      peripheral.position.set(2, 0.7, -1);
      scene.add(peripheral);
      addLabel(peripheral, '周边膜蛋白<br>固定膜结构', new THREE.Vector3(0, 1.2, 0));

      window.addEventListener('resize', onWindowResize);
    }

    // 磷脂分子生成函数
    function createPhospholipid(x, y, z, flip = false) {
      const group = new THREE.Group();
      const headMat = new THREE.MeshPhongMaterial({ color: 0xffcc00, specular: 0xffffff, shininess: 100 });
      const tailMat = new THREE.MeshPhongMaterial({ color: 0x00ccff, specular: 0xbbbbbb, shininess: 80 });

      // 亲水头：球体
      const headGeo = new THREE.SphereGeometry(0.15, 16, 16);
      const head = new THREE.Mesh(headGeo, headMat);
      head.position.set(0, 0, 0);
      group.add(head);

      // 疏水尾：两根圆柱
      const tailGeo = new THREE.CylinderGeometry(0.05, 0.05, 0.6, 12);
      for (let t = -0.1; t <= 0.1; t += 0.2) {
        const tail = new THREE.Mesh(tailGeo, tailMat);
        tail.rotation.x = Math.PI / 2;
        tail.position.set(t, 0, flip ? -0.5 : 0.5);
        group.add(tail);
      }

      group.position.set(x, y, z);
      if (flip) group.rotation.y = Math.PI;
      return group;
    }

    // 跨膜通道蛋白
    function createChannelProtein() {
      const mat = new THREE.MeshPhongMaterial({ color: 0x3377ff, specular: 0x8888ff, shininess: 120 });
      const geo = new THREE.CylinderGeometry(0.3, 0.3, 4, 24, 1, true);
      return new THREE.Mesh(geo, mat);
    }

    // 周边蛋白
    function createPeripheralProtein() {
      const mat = new THREE.MeshPhongMaterial({ color: 0xff5599, specular: 0xff88aa, shininess: 90 });
      const geo = new THREE.BoxGeometry(0.8, 0.4, 0.4);
      return new THREE.Mesh(geo, mat);
    }

    // 为对象添加 HTML 标签
    function addLabel(obj, text, offset) {
      const div = document.createElement('div');
      div.className = 'label';
      div.innerHTML = text;
      const label = new THREE.CSS2DObject(div);
      label.position.copy(offset);
      obj.add(label);
    }

    // 动画与渲染
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
    }

    // 自适应窗口变化
    function onWindowResize() {
      const container = document.getElementById('container');
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
      labelRenderer.setSize(container.clientWidth, container.clientHeight);
    }
  </script>
</body>
</html>